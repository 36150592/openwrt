#!/bin/sh
. /lib/functions.sh
. /lib/ramips.sh
. /lib/functions/uci-defaults-new.sh
. /lib/functions/system.sh


if [ ${#2} != 12 ]; then
echo "MAC address is 6 bytes!"
exit 1
fi

dd if=/dev/mtd2 of=/tmp/factory.img
sleep 1

printf "\x${2:0:2}\x${2:2:2}\x${2:4:2}\x${2:6:2}\x${2:8:2}\x${2:10:2}" | dd conv=notrunc of=/tmp/factory.img bs=1 seek=$((0x${1}))
sleep 1

mtd write /tmp/factory.img factory
sleep 3

yes | firstboot





